<div class="container">
  <p>本HowTo提供有关在OmegaT中翻译MS Office 2007及更高版本（Office Open XML，.docx）文件的提示。</p>
  <h3>背景</h3>
  <p>With the advent of Microsoft Office 2007, Microsoft Word, Excel and Powerpoint have new default file formats. These formats are formally known as "Office Open XML", and have the extensions .docx, .xlsx and .pptx respectively. The formats are also used in MS Office 2010. For the sake of convenience, they will be referred to below as "MS Office 2007 file formats".</p>
  <p>From Version 1.7.1 onwards, OmegaT has been able to handle Microsoft Office 2007 files directly, without conversion. With the appearance of OmegaT Version 2.1.8, the handling of this file format in OmegaT also became much more user-friendly.</p>
  <h3>与OmegaT结合使用.docx格式的优势</h3>
  <p>As customers/authors upgrade Microsoft Office/Word to more recent versions, translators can expect to receive files increasingly in the new format. Unlike the legacy .doc, .xls and .ppt formats, these files can be handled directly in OmegaT, with no loss of formatting as a result of conversion to and from other formats.</p>
  <p>The new format can also serve as a useful way of handling the legacy .doc, .xls and .ppt formats, since they can be converted to their MS Office 2007 counterparts, translated in OmegaT, and converted back again. This procedure is therefore an alternative for translators who would prefer not to use OpenOffice.org for this purpose.</p>
  <h3>转换为MS Office 2007格式</h3>
  <p>You can convert MS Office 1997/2000/2003/XP files to MS Office 2007 format by opening them in MS Office 2007 and saving them with "Save As" in the new format. (Since this is now the standard format, it is simply described as Word, Excel or Powerpoint in MS Office 2007).</p>
  <p>Linux用户：MS Office 2007和Microsoft兼容插件均在<a href="http://www.codeweavers.com"> Crossover Linux上运行。&lt;/ a0&gt;</p>
  <h3>在OmegaT中使用.docx，.xlsx和.pptx格式时需要注意的事项</h3>
  <p>In OmegaT versions prior to 2.1.8, each formatting change in an MS Office 2007 file resulted in a long series of multiple tags, which often made handling this file format impractical. As of version 2.1.8, by default, these multiple tags are now aggregated (condensed) into a single tag. Users wishing to translate MS Office 2007 files should therefore upgrade to OmegaT version 2.1.8 or later.</p>
  <p>(The greater ease of tag handling with .docx files comes at the cost of a slight loss in control over formatting. For example, without the "aggregate tags" function, where a word in the source text is in bold and italics, the translator could choose to render it in bold only, or in italics only. With the "aggregate tags" function enabled, this is not possible. Most users will probably find that the greater ease of use outweighs this drawback.)</p>
  <p>The .docx format is also prone to the introduction of "nuisance" formatting code which results in unwanted and unnecessary tags appearing in OmegaT's editor pane. Since these are inconvenient during translation, it is worthwhile trying to remove these nuisance tags before beginning translation in OmegaT. OmegaT shares this problem with other CAT tools that handle the .docx format, and the solutions are similar or the same.</p>
  <h3>如何从.docx文件中删除不需要的格式代码</h3>
  <ul>
    <li>
      <p>Word 2007 marks any words not in its spelling dictionary with tags, so even a couple of words which it considers to be mis-spelt will result in a plethora of tags. If every single word in OmegaT is enclosed within tags, it is possible that Word has attempted to spell-check the text without access to a suitable spelling dictionary, and has therefore marked each word as mis-spelt. One solution is to switch off automatic spelling checking in Word.</p>
    </li>
    <li>
      <p>Automatic hyphenation also adds unnecessary tags, so disable it. It may be necessary to do this for each document, in which case the procedure in Word 2007 is: Click the Page Layout tab; in the Page Setup group, click Hyphenation; then click None.</p>
    </li>
    <li>
      <p>使用"查找"和"替换"，用单空格替换双空格。</p>
    </li>
    <li>If your text contains both Asian and "normal" (e.g. Latin) characters, use Ctrl+A to select the entire text, then select a single font for it. Be careful to choose a font that contains both the necessary Asian and "normal" characters, such as MS Mincho, but without the "[text body]" style suffix.</li>
    <li>
      <p>Word 2007 inserts a tag at page breaks, even automatic page breaks. This tag apparently cannot be removed.</p>
    </li>
  </ul>
  <p>Note that even after Word's settings have been changed so that it does not insert "nuisance" codes, for example for auto-hyphenation, such codes may still be present in the file and not removed by the change in configuration. Removal of these codes is described below. Before following the instructions below for removal of the nuisance codes, however, remember to make the configuration changes in Word first, or Word may simply re-insert nuisance codes again when the file is next opened.</p>
  <h3>第三方工具</h3>
  <p>As already mentioned, this problem with MS Word is not unique to OmegaT. Third-party tools have been produced to deal with the problem. Two of these are:</p>
  <p><a href="http://asap-traduction.com/CodeZapper">CodeZapper</a> 便宜</p>
  <p><a href="http://www.translatortools.net/word-doccleaner.html">文件清洁器</a> (免费）</p>
  <h3>调平字符的格式</h3>
  <p>An alternative to running the CodeZapper macro on your text is to "level" the formatting. "Levelling" the formatting means applying the format of the first character in a selection of text (such as a whole paragraph) to all subsequent characters. Note that this is not the same as "deleting" the formatting, which would cause the character formatting to revert to the document's default.</p>
  <p>您基本上可以复制MS Word中的整个段落，并粘贴他们至整个段落，使整段采用第一个字符的格式来平整段落的格式。</p>
  <h3>手动调整段落的字符格式</h3>
  <p>Step 1: Unhide the paragraph mark. Mark each paragraph by clicking on it repeatedly until the entire paragraph is highlighted. Then move the end of the highlighting one character to the left so that it does not include the paragraph mark.</p>
  <p>Step 2: Copy this highlighted text (Ctrl+C). Then select "Paste Special" (Word 2003) or click on the arrow at the bottom of the "Insert" button (Word 2007) to obtain the extended Paste options. Finally, insert the content using the "Unformatted Unicode text" option.</p>
  <p>在段落包含内联格式（粗体，斜体，超链接等）的情况下，您可以：
</p>
  <p>- 如上所述使用宏对这些段落进行格式化，然后重新插入格式;要么
</p>
  <p>- 只将文本标记到格式化部分的开头，复制此文本并将其粘贴，然后在格式化后的部分之后对文本重复该过程。
 </p>
  <h3>创建一个宏来平整段落的字符格式
</h3>
  <p>You can automate the above procedure somewhat by creating a macro. Brief instructions for creating the macro (in MS Office 2007) are provided below. (For more detailed instructions, refer to your instruction manual or click <a href="http://www.dummies.com/how-to/content/how-to-create-a-word-2007-macro.html">here</a> or <a href="https://oit.nd.edu/assets/141085/word_2013_macros_qrg.pdf">here</a>.)</p>
  <p>If you have not already done so, add the Developer tab to the ribbon as follows: click on the Office button. Select Word Options. Click Popular in the Word Options dialog box. On the ribbon, check Show Developer tab and confirm with OK. Close Word.</p>
  <p>再次启动Word，创建一个新的Word文件并添加一段至少三行的示例文本，例如：</p>
  <p>This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph. This is a paragraph.</p>
  <p>点击段落标记按钮可以显示段落标记。</p>
  <p>将光标放在文本段落中（不在第一行或最后一行）。</p>
  <p>创建宏：</p>
  <p>在开发人员选项卡上，单击记录宏。</p>
  <p>In the Macro name box, type a name for the macro, such as "levelformat". To make the macro available in all documents, select Normal.dotm in the "Store macro in" box. If you have made changes to your Normal.dotm, you might want to back this up first.  </p>
  <p>Click on the Keyboard button. Click in the box for a new keyboard combination, then experiment with keyboard combinations to find one that is not assigned. If a combination you try is already assigned, a message to this effect is displayed in the dialogue, and you can delete the combination and try another. Ctrl+Shift+9 appears not to be assigned to any other function in the basic Word installation, but you can use any other combination that has not already been assigned.</p>
  <p>Click on Assign to assign the shortcut to the macro that you are about to record. Anything you now do will be recorded in the macro, so follow this procedure carefully:</p>
  <p>Ctrl +光标向上（这将光标移动到段落的开头）</p>
  <p>Ctrl + Shift +光标向下（这将选择段落，包括段落标记）</p>
  <p>Shift +光标左移（这会将选区的末尾向左移动一个字符，以便不再包含段落标记）</p>
  <p>Ctrl + C（复制此段落）</p>
  <p>Ctrl + V（这会将段落的文本粘贴到段落上）</p>
  <p>输入这些命令后，单击停止录制。</p>
  <p>Click on Macros and select levelformat (or whatever name you gave to your macro), then Edit. The 
code of your macro(s) will be displayed. For levelformat, this should be:</p>
  <p>___________________<br/>
Sub levelformat()<br/>
'<br/>
' levelformat macro<br/>
'<br/>
'<br/>
    Selection.MoveUp Unit:=wdParagraph, Count:=1<br/>
    Selection.MoveDown Unit:=wdParagraph, Count:=1, Extend:=wdExtend<br/>
    Selection.MoveLeft Unit:=wdWord, Count:=1, Extend:=wdExtend<br/>
    Selection.Copy<br/>
    Selection.PasteAndFormat (wdPasteDefault)<br/>
End Sub<br/>
___________________</p>
  <p>更改该行</p>
  <p>        Selection.PasteAndFormat (wdPasteDefault)</p>
  <p>改为:</p>
  <p>        Selection.PasteSpecial DataType:=wdPasteText</p>
  <p>用Ctrl + S保存，然后关闭宏编辑窗口。</p>
  <p>If all has gone according to plan, your macro should now work. To test it, add some formatting to your Word document, for example by making one word bold. Now simply place the cursor anywhere in the paragraph and press Ctrl+Shift+9 (or whatever other keyboard shortcut you selected), and you should see the formatting disappear.</p>
  <p>You can change the keyboard shortcut at any time. To do this, click the main "Office" button, then Word options (bottom right of the dialog).</p>
  <p>Click Customize &gt; Choose commands. Choose Macros from the drop-down list. Select "levelformat" (or whatever you called it).</p>
  <p>在键盘快捷键旁边对话框的底部，点击自定义。</p>
  <p>In the Categories box, scroll down to Macros and select it. Then on the right, under Macros, select levelformat (or whatever you called your macro). The current shortcut will be displayed in the relevant box. You can clear it by selecting it and hitting Delete. You can then enter a new shortcut and assign it with Assign as you did before. Close/confirm the dialogs.</p>
  <p>您可以使用类似的过程为您的宏创建一个按钮：</p>
  <p>再次点击主“Office”按钮，然后点击Word选项。</p>
  <p>Click Customize &gt; Choose commands. Choose Macros from the drop-down list. Select your macro.</p>
  <p>Click on Add. You should see the macro command appear in the right-hand column. Click on Modify.</p>
  <p>Pick a symbol, then OK &gt; OK. The symbol for your macro should appear in the toolbar.</p>
  <p>This macro is useful for levelling the formatting of a whole paragraph that contains no visible formatting. Where a paragraph contains desired formatting, you must restore the deleted formatting after levelling the paragraph. In paragraphs containing lots of formatting, restoring the deleted formatting can be quite a lot of work. For such paragraphs, consider the following alternatives:  </p>
  <ul>
    <li>
      <p>使用Dave Turner的CodeZapper宏。 </p>
    </li>
    <li>
      <p>Create a second macro (with its own button and/or keyboard shortcut) of your own that only levels highlighted text, rather than the entire paragraph. (Record as described above, but only recording the command Ctrl+C followed by Ctrl+V.) You can then highlight text between the points at which formatting changes. This will level the formatting over sections of text that have the same, desired formatting, and you will not then need to restore deleted formatting.</p>
    </li>
    <li>
      <p>Use the level formatting macro only on paragraphs with little or no formatting. Paragraphs that you have not "levelled" will then contain nuisance tags, but at least the others will be much "cleaner".</p>
    </li>
    <li>
      <p>More advanced users may wish to try OmegaT's Text Export function. In conjunction with the te-st-notags script, this provides a separate window in which tags are not displayed. You must still handle tags properly when producing and editing your translation, but you can view it in a separate window without the clutter of tags ("tag soup").</p>
    </li>
  </ul>
  <p>版权归属于Marc Prior 2009-2011</p>
</div>
